{"version":3,"file":"ngx-zendesk-webwidget.mjs","sources":["../../../src/lib/ngx-zendesk-webwidget.model.ts","../../../src/lib/ngx-zendesk-webwidget.service.ts","../../../src/lib/ngx-zendesk-webwidget.module.ts","../../../src/ngx-zendesk-webwidget.ts"],"sourcesContent":["export abstract class NgxZendeskWebwidgetConfig {\r\n  lazyLoad: boolean;\r\n  timeOut: number;\r\n  injectionTag: 'head' | 'body' | 'script' | string;\r\n  abstract accountUrl: string;\r\n  abstract callback(zE: any): any;\r\n}\r\n","import { Injectable } from '@angular/core';\r\n\r\nimport { NgxZendeskWebwidgetConfig } from './ngx-zendesk-webwidget.model';\r\n\r\nfunction getWindow(): any {\r\n  return window;\r\n}\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class NgxZendeskWebwidgetService {\r\n\r\n  private readonly window: any;\r\n  private initialized = false;\r\n  private _zE: any;\r\n\r\n  constructor(private ngxZendeskWebwidgetConfig: NgxZendeskWebwidgetConfig) {\r\n    if (!this.ngxZendeskWebwidgetConfig.accountUrl) {\r\n      throw new Error('Missing accountUrl. Please set in app config via ZendeskWidgetProvider');\r\n    }\r\n\r\n    this.window = getWindow();\r\n\r\n    if (!this.ngxZendeskWebwidgetConfig.lazyLoad) {\r\n      this.initZendesk();\r\n    }\r\n  }\r\n\r\n  public initZendesk(): Promise<boolean> {\r\n    const window = this.window;\r\n    const config = this.ngxZendeskWebwidgetConfig;\r\n\r\n    // tslint:disable\r\n    window.zEmbed || function(e, t) {\r\n      let n, o, d, i, s, a = []\r\n      let r = document.createElement(\"iframe\")\r\n      window.zEmbed = function() {\r\n        a.push(arguments)\r\n      }\r\n      window.zE = window.zE || window.zEmbed\r\n      r.src = \"javascript:false\"\r\n      r.title = \"\"\r\n      r.style.cssText = \"display: none\"\r\n      d = document.getElementsByTagName(config.injectionTag || \"head\")\r\n      d = d[d.length - 1]\r\n      d.parentNode.insertBefore(r, d)\r\n      i = r.contentWindow\r\n      s = i.document\r\n      try {\r\n        o = s\r\n      } catch (e) {\r\n        n = document.domain\r\n        r.src = 'javascript:var d=document.open();d.domain=\"' + n + '\";void(0);'\r\n        o = s\r\n      }\r\n      o.open()._l = function() {\r\n        let e = this.createElement(\"script\")\r\n        n && (this.domain = n)\r\n        e.id = \"js-iframe-async\"\r\n        e.src = \"https://static.zdassets.com/ekr/snippet.js\"\r\n        this.t += new Date\r\n        this.zendeskHost = config.accountUrl\r\n        this.zEQueue = a\r\n        this.body.appendChild(e)\r\n      }\r\n      o.write('<body onload=\"document._l();\">')\r\n      o.close()\r\n    }();\r\n    // tslint:enable\r\n\r\n    return this.finishLoading();\r\n  }\r\n\r\n  private finishLoading(): Promise<boolean> {\r\n    return new Promise<boolean>((resolve, reject) => {\r\n\r\n      const timeout = setTimeout(() => {\r\n        this.initialized = false;\r\n        reject(Error('timeout'));\r\n      }, this.ngxZendeskWebwidgetConfig.timeOut || 30000); // 30 seconds\r\n\r\n      this.window.zE(() => {\r\n        this.ngxZendeskWebwidgetConfig.callback(this.window.zE);\r\n        this.initialized = true;\r\n        this._zE = this.window.zE;\r\n        clearTimeout(timeout);\r\n        resolve(true);\r\n      });\r\n    });\r\n  }\r\n\r\n  get isInitialized(): boolean {\r\n    return this.initialized;\r\n  }\r\n\r\n  get zE(): any {\r\n    return this._zE\r\n  }\r\n}\r\n","import { NgModule, ModuleWithProviders, Type } from '@angular/core'\r\nimport { NgxZendeskWebwidgetConfig } from './ngx-zendesk-webwidget.model'\r\nimport { NgxZendeskWebwidgetService } from './ngx-zendesk-webwidget.service'\r\n\r\n@NgModule({})\r\nexport class NgxZendeskWebwidgetModule {\r\n  static forRoot(zendeskConfig: Type<NgxZendeskWebwidgetConfig>): ModuleWithProviders<NgxZendeskWebwidgetModule> {\r\n    return {\r\n      ngModule: NgxZendeskWebwidgetModule,\r\n      providers: [\r\n        {provide: NgxZendeskWebwidgetConfig, useClass: zendeskConfig },\r\n        {provide: NgxZendeskWebwidgetService, useClass: NgxZendeskWebwidgetService, deps: [NgxZendeskWebwidgetConfig] }\r\n      ]\r\n    }\r\n  }\r\n}\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["i1.NgxZendeskWebwidgetConfig"],"mappings":"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"}